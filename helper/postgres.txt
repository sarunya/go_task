/*  COUPONS  */

CREATE TABLE IF NOT EXISTS user
(
  email_id text,
  password text,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT coupons_pkey PRIMARY KEY (id)
  
)
WITH (
  OIDS=FALSE
);
ALTER TABLE coupons
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS coupons_coupon_code_and_is_active_idx
  ON coupons
  USING btree
 ((data->>'coupon_code'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS coupons_active_unique_idx
 ON coupons
  USING btree
  ((data->>'coupon_code'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS coupons_offer_id_is_active_and_status_idx
  ON coupons
  USING btree
 ((data->>'offer_id'), (data->>'is_active'), (data->>'status'));

CREATE INDEX IF NOT EXISTS coupons_coupon_code_idx
  ON coupons
  USING btree
 ((data->>'coupon_code'));

CREATE INDEX IF NOT EXISTS coupons_offer_id_idx
  ON coupons
  USING btree
 ((data->>'offer_id'));

CREATE INDEX IF NOT EXISTS coupons_modified_date_index 
  ON coupons(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS coupons_created_date_index 
  ON coupons(created_date DESC NULLS LAST);

DROP INDEX IF EXISTS coupons_coupon_code_and_is_deleted_idx;


/*  COUPONUSAGES  */

CREATE TABLE IF NOT EXISTS couponusages
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT couponusages_pkey PRIMARY KEY (id)
  
)
WITH (
  OIDS=FALSE
);
ALTER TABLE couponusages
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS couponusages_coupon_code_and_is_active_idx
  ON couponusages
  USING btree
 ((data->>'coupon_code'), (data->>'is_active'));


CREATE UNIQUE INDEX IF NOT EXISTS couponusages_active_unique_idx
 ON couponusages
  USING btree
  ((data->>'coupon_code'), (data->>'is_active'), (data->>'email_address')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS couponusages_coupon_code_and_is_active_and_email_idx
  ON couponusages
  USING btree
 ((data->>'coupon_code'), (data->>'is_active'), (data->>'email_address'));

CREATE INDEX IF NOT EXISTS couponusages_modified_date_index 
  ON couponusages(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS couponusages_created_date_index 
  ON couponusages(created_date DESC NULLS LAST);

DROP INDEX IF EXISTS couponusages_coupon_code_and_is_deleted_and_email_idx;


/*  OFFERS  */

CREATE TABLE IF NOT EXISTS offers
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT offers_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE offers
  OWNER TO ecomdbapriceengine;

DROP INDEX IF EXISTS offers_type_idx;
DROP INDEX IF EXISTS offers_start_date_idx;
DROP INDEX IF EXISTS offers_end_date_idx;
DROP INDEX IF EXISTS offers_status_idx;
DROP INDEX IF EXISTS offers_trigger_amount_idx;
DROP INDEX IF EXISTS offers_channel_is_active_idx;

CREATE INDEX IF NOT EXISTS offers_offer_id_and_is_active_idx
  ON offers
  USING btree
 ((data->>'offer_id'), (data->>'is_active'));

 CREATE UNIQUE INDEX IF NOT EXISTS offers_active_unique_idx
 ON offers
 USING btree
 ((data->>'offer_id'), (data->>'is_active')) where data->>'is_active'= 'true';

 CREATE UNIQUE INDEX IF NOT EXISTS offers_offer_hash_active_unique_idx
 ON offers
 USING btree
 ((data->>'offer_hash'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS offers_offer_id_idx
  ON offers
  USING btree
 ((data->>'offer_id'));

CREATE INDEX IF NOT EXISTS offers_search_offers_web_ingestion_using_dates_idx
  ON offers
  USING btree
 ((data->>'offer_id'), (data->>'status'), (data->>'coupon_code_triggered'), (data->>'start_date'), (data->>'end_date'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS offers_search_offers_web_ingestion_current_idx
  ON offers
  USING btree
 ((data->>'offer_id'), (data->>'status'), (data->>'coupon_code_triggered'), (data->>'end_date'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS offers_type_offer_status_coupon_code_triggered_trigger_amount_channel_idx
  ON offers
  USING btree
 ((data->>'type'), (data->>'status'), (data->>'coupon_code_triggered'), cast (data->>'trigger_amount' AS double precision), (data->>'channel'));

CREATE INDEX IF NOT EXISTS offers_type_offer_status_idx
  ON offers
  USING btree
 ((data->>'type'), (data->>'status'));

 CREATE INDEX IF NOT EXISTS offers_type_offer_status_start_date_end_date_idx
  ON offers
  USING btree
 ((data->>'type'), (data->>'status'), (data->>'start_date'), (data->>'end_date'));

 CREATE INDEX IF NOT EXISTS offer_status_start_date_end_date_idx
  ON offers
  USING btree
 ((data->>'status'), (data->>'start_date'), (data->>'end_date'));
 

 CREATE INDEX IF NOT EXISTS offers_shipping_info_shipping_method_idx
  ON offers
  USING btree
 ((data->'shipping_info'->>'shipping_method'));

CREATE INDEX IF NOT EXISTS offers_modified_date_index 
  ON offers(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS offers_created_date_index 
  ON offers(created_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS offers_channel_is_active_idx
  ON offers
  USING btree
 ((data->>'channel'), (data->>'is_active'), (data->>'start_date'), (data->>'end_date'), (data->>'status'));

CREATE INDEX IF NOT EXISTS offers_hash
  ON offers
  USING btree 
 ((data->>'offer_hash'));

 CREATE INDEX IF NOT EXISTS offers_is_active_channel_idx
  ON offers
  USING btree
 ((data->>'offer_id'), (data->>'is_active'), (data->>'channel'));

CREATE EXTENSION IF NOT EXISTS pg_trgm;
CREATE INDEX IF NOT EXISTS offers_name_trgm_idx ON offers USING GIST ((data->>'name') gist_trgm_ops);

  /*  OFFERUSAGES  */

  CREATE TABLE IF NOT EXISTS offerusages
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT offerusages_pkey PRIMARY KEY (id)
  
)
WITH (
  OIDS=FALSE
);
ALTER TABLE offerusages
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS offerusages_offer_id_and_is_active_idx
  ON offerusages
  USING btree
 ((data->>'offer_id'), (data->>'is_active'));

 CREATE INDEX IF NOT EXISTS offerusages_offer_id_and_is_active_created_date_idx
  ON offerusages
  USING btree
 ((data->>'offer_id'), (data->>'is_active'), created_date);

CREATE UNIQUE INDEX IF NOT EXISTS offerusages_active_unique_idx
 ON offerusages
 USING btree
 ((data->>'offer_id'), (data->>'is_active'), (data->>'email_address')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS offerusages_offer_id_and_is_active_and_email_idx
  ON offerusages
  USING btree
 ((data->>'offer_id'), (data->>'is_active'), (data->>'email_address'));

CREATE INDEX IF NOT EXISTS offerusages_modified_date_index 
  ON offerusages(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS offerusages_created_date_index 
  ON offerusages(created_date DESC NULLS LAST);


/*  SKUOFFERMAPPINGS  */


CREATE TABLE IF NOT EXISTS skuoffermappings
(
  id text,
  sku text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT skuoffermappings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);

DROP INDEX IF EXISTS skuoffermappings_offer_id_and_is_active_idx;
DROP INDEX IF EXISTS skuoffermappings_offer_id_idx;
DROP INDEX IF EXISTS skuoffermappings_start_date_idx;
DROP INDEX IF EXISTS skuoffermappings_end_date_idx;
DROP INDEX IF EXISTS skuoffermappings_status_idx;
DROP INDEX IF EXISTS skuoffermappings_trigger_amount_idx;
DROP INDEX IF EXISTS skuoffermappings_shipping_info_shipping_method_idx;
DROP INDEX IF EXISTS skuoffermappings_sku_status_start_date_end_date_is_active_coupon_code_triggered_type_idx;
DROP INDEX IF EXISTS skuoffermappings_sku_status_start_date_end_date_is_active_idx;
DROP INDEX IF EXISTS skuoffermappings_sku_status_start_date_end_date_is_active_shipping_method_coupon_code_triggered_type__trigger_amount_idx;
DROP INDEX IF EXISTS skuoffermappings_offer_id_sku_idx;


ALTER TABLE skuoffermappings
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS skuoffermappings_sku_status_end_date_is_active_coupon_code_triggered_type_channel_idx
  ON skuoffermappings
  USING btree
 (sku, (data->>'status'), (data->>'end_date'), (data->>'is_active'), (data->>'coupon_code_triggered'), (data->>'type'), (data->>'channel'));

CREATE INDEX IF NOT EXISTS skuoffermappings_sku_status_end_date_is_active_coupon_code_triggered_channel_idx
  ON skuoffermappings
  USING btree
 (sku, (data->>'status'), (data->>'end_date'), (data->>'is_active'), (data->>'coupon_code_triggered'), (data->>'channel'));

 CREATE INDEX IF NOT EXISTS skuoffermappings_sku_status_start_date_end_date_is_active_idx
  ON skuoffermappings
  USING btree
 (sku, (data->>'status'), (data->>'start_date'), (data->>'end_date'), (data->>'is_active'));


 CREATE INDEX IF NOT EXISTS skuoffermappings_sku_status_start_date_end_date_is_active_shipping_method_coupon_code_triggered_type_channel__trigger_amount_idx
  ON skuoffermappings
  USING btree
 (sku, (data->>'is_active'), (data->'shipping_info'->>'shipping_method'), (data->>'status'), (data->>'end_date'), (data->>'coupon_code_triggered'), (data->>'type'), (data->>'channel'), cast(data->'shipping_info'->>'trigger_amount' as double precision));

 CREATE UNIQUE INDEX IF NOT EXISTS skuoffermappings_offer_id_sku_active_idx
  ON skuoffermappings
  USING btree
 (sku, (data->>'offer_id'), (data->>'is_active')) where data->>'is_active'= 'true'; 

 CREATE INDEX IF NOT EXISTS skuoffermappings_sku_status_active_idx
  ON skuoffermappings
  USING btree
 (sku, (data->>'status'), (data->>'is_active')) where data->>'is_active'= 'true'; 

 CREATE INDEX IF NOT EXISTS skuoffermappings_offer_id_idx
  ON skuoffermappings
  USING btree
 ((data->>'offer_id'));

 CREATE INDEX IF NOT EXISTS skuoffermappings_sku_is_active_idx
  ON skuoffermappings
  USING btree
 (sku, (data->>'is_active'));

CREATE INDEX IF NOT EXISTS skuoffermappings_modified_date_index 
  ON skuoffermappings(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS skuoffermappings_created_date_index 
  ON skuoffermappings(created_date DESC NULLS LAST);


/* TAXONOMYOFFERMAPPINGS */

CREATE TABLE IF NOT EXISTS taxonomyoffermappings
(
  id text,
  product_family text,
  product_category text,
  primary_filter text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT taxonomyoffermappings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);

ALTER TABLE taxonomyoffermappings
  OWNER TO ecomdbapriceengine;

CREATE UNIQUE INDEX IF NOT EXISTS taxonomyoffermappings_offer_id_category_family_active_idx
  ON taxonomyoffermappings
  USING btree
 (product_family, product_category, primary_filter, (data->>'offer_id'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS taxonomyoffermappings_taxonomy_filter_status_channel_coupon_active_idx
  ON taxonomyoffermappings
  USING btree
 (product_family, product_category, primary_filter, (data->>'status'), (data->>'is_active'), (data->>'channel'), (data->>'coupon_code_triggered')) where data->>'is_active'= 'true'; 

CREATE INDEX IF NOT EXISTS taxonomyoffermappings__category_family_filter_status_channel_coupon_end_date_active_idx
  ON taxonomyoffermappings
  USING btree
 (product_family, product_category, primary_filter, (data->>'status'), (data->>'is_active'), (data->>'channel'), (data->>'coupon_code_triggered'), (data->>'end_date')) where data->>'is_active'= 'true';  

CREATE INDEX IF NOT EXISTS taxonomyoffermappings_category_family_active_idx
  ON taxonomyoffermappings
  USING btree
 (product_family, product_category, primary_filter, (data->>'is_active'));

 CREATE INDEX IF NOT EXISTS taxonomyoffermappings_offerid_idx
  ON taxonomyoffermappings
  USING btree
 ((data->>'offer_id'));

/*FINANCEPLANOFFERMAPPINGS */

CREATE TABLE IF NOT EXISTS financeplanoffermappings
(
  id text,
  finance_plan_id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT financeplanoffermappings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);

ALTER TABLE financeplanoffermappings
  OWNER TO ecomdbapriceengine;

CREATE UNIQUE INDEX IF NOT EXISTS financeplanoffermappings_offer_id_finance_plan_id_active_idx
  ON financeplanoffermappings
  USING btree
 (finance_plan_id, (data->>'offer_id'), (data->>'is_active')) where data->>'is_active'= 'true'; 

CREATE INDEX IF NOT EXISTS financeplanoffermappings_finance_plan_id_active_idx
  ON financeplanoffermappings
  USING btree
 (finance_plan_id, (data->>'is_active'));

CREATE INDEX IF NOT EXISTS financeplanoffermappings_offerid_idx
 ON financeplanoffermappings
 USING btree
 ((data->>'offer_id'));

CREATE INDEX IF NOT EXISTS financeplanoffermappings_modified_date_index 
 ON financeplanoffermappings(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS financeplanoffermappings_created_date_index 
 ON financeplanoffermappings(created_date DESC NULLS LAST);


/*  PROMOTIONS  */


CREATE TABLE IF NOT EXISTS promotions
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT promotions_pkey PRIMARY KEY (id)
  
)
WITH (
  OIDS=FALSE
);
ALTER TABLE promotions
  OWNER TO ecomdbapriceengine;

DROP INDEX IF EXISTS promotions_type_idx;
DROP INDEX IF EXISTS promotions_start_date_idx;
DROP INDEX IF EXISTS promotions_end_date_idx;
DROP INDEX IF EXISTS promotions_channel_idx;

CREATE INDEX IF NOT EXISTS promotions_promotion_id_and_is_active_idx
  ON promotions
  USING btree
 ((data->>'promotion_id'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS promotions_active_unique_idx
 ON promotions
 USING btree
 ((data->>'promotion_id'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE UNIQUE INDEX IF NOT EXISTS promotions_promotion_hash_active_unique_idx
 ON promotions
 USING btree
 ((data->>'promotion_hash'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS promotions_promotion_id_idx
  ON promotions
  USING btree
 ((data->>'promotion_id'));

CREATE INDEX IF NOT EXISTS promotions_type_status_start_date_end_date_idx
  ON promotions
  USING btree
 ((data->>'type'), (data->>'status'), (data->>'start_date'), (data->>'end_date'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS promotions_type_status_end_date_idx
  ON promotions
  USING btree
 ((data->>'type'), (data->>'status'), (data->>'end_date'), (data->>'is_active'));


CREATE INDEX IF NOT EXISTS promotions_type_status_channel_active_idx
  ON promotions
  USING btree
 ((data->>'type'), (data->>'status'), (data->>'channel'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS promotions_end_date_status_channel_active_idx
  ON promotions
  USING btree
 ((data->>'end_date'), (data->>'status'), (data->>'channel'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS promotions_status_end_date_active_idx
  ON promotions
  USING btree
 ((data->>'is_active'), (data->>'status'), (data->>'end_date'));

 CREATE INDEX IF NOT EXISTS promotions_modified_date_index 
  ON promotions(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS promotions_created_date_index 
  ON promotions(created_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS promotions_promotion_hash
  ON promotions
  USING btree
 ((data->>'promotion_hash'));

CREATE INDEX IF NOT EXISTS promotions_channel_idx
  ON promotions
  USING btree
 ((data->>'channel'), (data->>'is_active'), (data->>'status'), (data->>'start_date'), (data->>'end_date'));

  /*  SKUPROMOTIONMAPPINGSS  */

CREATE TABLE IF NOT EXISTS skupromotionmappings
(
  id text,
  data jsonb,
  sku text,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT skupromotionmappings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE skupromotionmappings
  OWNER TO ecomdbapriceengine;

DROP INDEX IF EXISTS skupromotionmappings_promotion_id_and_is_active_idx;
DROP INDEX IF EXISTS skupromotionmappings_promotion_id_idx;
DROP INDEX IF EXISTS skupromotionmappings_type_idx;
DROP INDEX IF EXISTS skupromotionmappings_start_date_idx;
DROP INDEX IF EXISTS skupromotionmappings_end_date_idx;
DROP INDEX IF EXISTS skupromotionmappings_sku_and_is_active_status_start_date_end_date_idx;
DROP INDEX IF EXISTS skupromotionmappings_sku_and_promotion_id_idx;

CREATE INDEX IF NOT EXISTS skupromotionmappings_sku_and_is_active_status_end_date_idx
  ON skupromotionmappings
  USING btree
 (sku, (data->>'is_active'), (data->>'status'), (data->>'end_date'));

CREATE INDEX IF NOT EXISTS skupromotionmappings_sku_and_is_active_status_end_date_type_idx
  ON skupromotionmappings
  USING btree
 (sku, (data->>'is_active'), (data->>'status'), (data->>'end_date'), (data->>'type'));

CREATE INDEX IF NOT EXISTS skupromotionmappings_sku_and_promotion_id_idx
  ON skupromotionmappings
  USING btree
 (sku, (data->>'promotion_id'));

CREATE INDEX IF NOT EXISTS skupromotionmappings_promotion_id_idx
  ON skupromotionmappings
  USING btree
 ((data->>'promotion_id'));

CREATE INDEX IF NOT EXISTS skupromotionmappings_promotion_id_and_is_active_idx
  ON skupromotionmappings
  USING btree
 ((data->>'promotion_id'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS skupromotionmappings_active_unique_idx
 ON skupromotionmappings
 USING btree
 (sku, (data->>'promotion_id'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS skupromotionmappings_modified_date_index 
 ON skupromotionmappings(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS skupromotionmappings_created_date_index 
 ON skupromotionmappings(created_date DESC NULLS LAST);


   /*  PRIVATESTOREUSAGES  */

CREATE TABLE IF NOT EXISTS privatestoreusages (
    id text,
    data jsonb,
    created_date timestamp with time zone DEFAULT now(),
    modified_date timestamp with time zone DEFAULT now(),
    CONSTRAINT privatestoreusages_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);

ALTER TABLE privatestoreusages
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS privatestoreusages_plan_id_and_is_active_and_email_idx
  ON privatestoreusages
  USING btree
 ((data->>'plan_id'), (data->>'is_active'), (data->>'email_address'));

CREATE UNIQUE INDEX IF NOT EXISTS privatestoreusages_active_unique_idx
 ON privatestoreusages
 USING btree
 ((data->>'plan_id'), (data->>'is_active'), (data->>'email_address')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS privatestoreusages_modified_date_index 
  ON privatestoreusages(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS privatestoreusages_created_date_index 
  ON privatestoreusages(created_date DESC NULLS LAST);

   /*  PRODUCTCATALOGS  */

CREATE TABLE IF NOT EXISTS productcatalogs
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT productcatalogs_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE productcatalogs
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS productcatalogs_sku_idx
  ON productcatalogs
  USING btree
 ((data->>'sku'));

 CREATE INDEX IF NOT EXISTS productcatalogs_sku_is_active_idx
  ON productcatalogs
  USING btree
 ((data->>'sku'), (data->>'is_active'));

  CREATE INDEX IF NOT EXISTS productcatalogs_is_active_idx
  ON productcatalogs
  USING btree
 ((data->>'is_active'));

  CREATE INDEX IF NOT EXISTS productcatalogs_product_family_is_active_idx
  ON productcatalogs
  USING btree
  ((data->'taxonomy'->>'product_family'), (data->>'is_active'));

  CREATE INDEX IF NOT EXISTS productcatalogs_product_family_category_filter_is_active_idx
  ON productcatalogs
  USING btree
  ((data->'taxonomy'->>'product_family'), (data->'taxonomy'->>'product_category'), (data->'taxonomy'->>'primary_filter'), (data->>'is_active'));

  CREATE INDEX IF NOT EXISTS productcatalogs_product_family_is_active_idx
  ON productcatalogs
  USING btree
  ((data->'taxonomy'->>'product_family'), (data->>'is_active'));

  CREATE INDEX IF NOT EXISTS productcatalogs_product_family_category_is_active_idx
  ON productcatalogs
  USING btree
  ((data->'taxonomy'->>'product_family'), (data->'taxonomy'->>'product_category'), (data->>'is_active'));

  CREATE UNIQUE INDEX IF NOT EXISTS productcatalogs_active_unique_idx
  ON productcatalogs
  USING btree
  ((data->>'sku'), (data->>'is_active')) where data->>'is_active'= 'true';

  CREATE INDEX IF NOT EXISTS productcatalogs_modified_date_index 
  ON productcatalogs(modified_date DESC NULLS LAST);

  CREATE INDEX IF NOT EXISTS productcatalogs_created_date_index 
  ON productcatalogs(created_date DESC NULLS LAST);


  /*  PRIVATESTORES  */

CREATE TABLE IF NOT EXISTS privatestores
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT privatestores_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE privatestores
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS privatestores_plan_id_idx
  ON privatestores
  USING btree
 ((data->>'plan_id'));

 CREATE INDEX IF NOT EXISTS privatestores_plan_id_is_active_idx
  ON privatestores
  USING btree
 ((data->>'plan_id'), (data->>'is_active'));

 CREATE INDEX IF NOT EXISTS privatestores_is_active_idx
  ON privatestores
  USING btree
 ((data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS privatestores_active_unique_idx
 ON privatestores
 USING btree
 ((data->>'plan_id'), (data->>'is_active')) where data->>'is_active'= 'true';

 CREATE INDEX IF NOT EXISTS privatestores_modified_date_index 
  ON privatestores(modified_date DESC NULLS LAST);

 CREATE INDEX IF NOT EXISTS privatestores_created_date_index 
  ON privatestores(created_date DESC NULLS LAST);


/*  PRODUCTPRICINGS  */
  
CREATE TABLE IF NOT EXISTS productpricings (
    id text,
    data jsonb,
    created_date timestamp with time zone DEFAULT now(),
    modified_date timestamp with time zone DEFAULT now(),
    CONSTRAINT productpricings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE productpricings
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS productpricings_sku_and_is_active_and_valid_from_idx
  ON productpricings
  USING btree
 ((data->>'sku'), (data->>'is_active'), (data->>'valid_from'));

 CREATE INDEX IF NOT EXISTS productpricings_sku_and_is_active_idx
  ON productpricings
  USING btree
 ((data->>'sku'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS productpricings_active_unique_idx
 ON productpricings
 USING btree
 ((data->>'sku'), (data->>'is_active'), (data->>'valid_from')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS productpricings_modified_date_index 
  ON productpricings(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS productpricings_created_date_index 
  ON productpricings(created_date DESC NULLS LAST);


/*  PRODUCTPRICINGS  */
  
CREATE TABLE IF NOT EXISTS b2bdiscounts (
    id text,
    data jsonb,
    created_date timestamp with time zone DEFAULT now(),
    modified_date timestamp with time zone DEFAULT now(),
    CONSTRAINT b2bdiscounts_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE b2bdiscounts
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS b2bdiscounts_active_valid_from_type_value_idx
 ON b2bdiscounts
 USING btree
((data->>'sku'), (data->>'is_active'), (data->>'valid_from'), (data->'criteria'->>'type'), (data->'criteria'->>'value')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS b2bdiscounts_active_valid_from_type_idx
 ON b2bdiscounts
 USING btree
((data->>'sku'), (data->>'is_active'), (data->>'valid_from'), (data->'criteria'->>'type')) where data->>'is_active'= 'true';

CREATE UNIQUE INDEX IF NOT EXISTS b2bdiscounts_active_unique_idx
 ON b2bdiscounts
 USING btree
 ((data->>'sku'), (data->>'is_active'), (data->>'valid_from'), (data->'criteria'->>'type'), (data->'criteria'->>'value')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS b2bdiscounts_modified_date_index 
  ON b2bdiscounts(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS b2bdiscounts_created_date_index 
  ON b2bdiscounts(created_date DESC NULLS LAST);


/*  FINANCEPLANPRODUCTPRICINGS  */
  
CREATE TABLE IF NOT EXISTS financeplanproductpricings (
    id text,
    data jsonb,
    created_date timestamp with time zone DEFAULT now(),
    modified_date timestamp with time zone DEFAULT now(),
    CONSTRAINT productfinanceplanpricings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE financeplanproductpricings
  OWNER TO ecomdbapriceengine;

CREATE UNIQUE INDEX IF NOT EXISTS financeplanproductpricings_sku_and_finance_plan_id_finance_plan_pk_id_valid_from_and_is_active_idx
  ON financeplanproductpricings
  USING btree
 ((data->>'sku'), (data->>'finance_plan_id'), (data->>'finance_plan_pk_id'), (data->>'valid_from'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS financeplanproductpricings_sku_and_finance_plan_id_finance_plan_pk_id_valid_from_and_is_active_idx
  ON financeplanproductpricings
  USING btree
 ((data->>'sku'), (data->>'finance_plan_id'), (data->>'finance_plan_pk_id'), (data->>'valid_from'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS financeplanproductpricings_sku_and_finance_plan_id_and_is_active_idx
  ON financeplanproductpricings
  USING btree
 ((data->>'sku'), (data->>'finance_plan_id'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS financeplanproductpricings_sku_and_finance_plan_id_and_valid_from_is_active_idx
  ON financeplanproductpricings
  USING btree
 ((data->>'sku'), (data->>'finance_plan_id'), (data->>'valid_from'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS financeplanproductpricings_finance_plan_pk_id_and_is_active_idx
  ON financeplanproductpricings
  USING btree
 ((data->>'finance_plan_pk_id'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS financeplanproductpricings_sku_and_is_active_idx
  ON financeplanproductpricings
  USING btree
 ((data->>'sku'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS financeplanproductpricings_finance_plan_id_and_is_active_idx
  ON financeplanproductpricings
  USING btree
 ((data->>'finance_plan_id'), (data->>'is_active'));

CREATE INDEX IF NOT EXISTS financeplanproductpricings_modified_date_index 
  ON financeplanproductpricings(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS financeplanproductpricings_created_date_index 
  ON financeplanproductpricings(created_date DESC NULLS LAST);

/*  PRIVATESTOREDISCOUNTS  */

CREATE TABLE IF NOT EXISTS privatestorediscounts (
    id text,
    data jsonb,
    created_date timestamp with time zone DEFAULT now(),
    modified_date timestamp with time zone DEFAULT now(),
    CONSTRAINT privatestorediscounts_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);

ALTER TABLE privatestorediscounts
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS privatestorediscounts_sku_and_private_store_group_id_and_is_active_idx
  ON privatestorediscounts
  USING btree
 ((data->>'sku'),  (data->>'private_store_group_id'), (data->>'is_active'), (data->>'valid_from'));


CREATE UNIQUE INDEX IF NOT EXISTS privatestorediscounts_active_unique_idx
 ON privatestorediscounts
 USING btree
 ((data->>'sku'), (data->>'private_store_group_id'), (data->>'is_active'), (data->>'valid_from')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS privatestorediscounts_modified_date_index 
  ON privatestorediscounts(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS privatestorediscounts_created_date_index 
  ON privatestorediscounts(created_date DESC NULLS LAST);

/*  PRIVATESTOREGROUPS  */


CREATE TABLE IF NOT EXISTS privatestoregroups
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT privatestoregroups_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE privatestoregroups
  OWNER TO ecomdbapriceengine;

DROP INDEX IF EXISTS privatestoregroups_plan_id_idx;

 CREATE INDEX IF NOT EXISTS privatestoregroups_plan_id_is_active_idx
  ON privatestoregroups
  USING btree
 ((data->>'plan_id'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS privatestoregroups_active_unique_idx
 ON privatestoregroups
 USING btree
 ((data->>'plan_id'), (data->>'is_active')) where data->>'is_active'= 'true';

 CREATE INDEX IF NOT EXISTS privatestoregroups_is_active_idx
  ON privatestoregroups
  USING btree
 ((data->>'is_active'));

CREATE INDEX IF NOT EXISTS privatestoregroups_modified_date_index 
  ON privatestoregroups(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS privatestoregroups_created_date_index 
  ON privatestoregroups(created_date DESC NULLS LAST);

  /*  PRIVATESTOREGROUPINFOS  */


CREATE TABLE IF NOT EXISTS privatestoregroupinfos
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT privatestoregroupinfos_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE privatestoregroupinfos
  OWNER TO ecomdbapriceengine;

 CREATE INDEX IF NOT EXISTS privatestoregroupinfos_group_id_is_active_idx
  ON privatestoregroupinfos
  USING btree
 ((data->>'group_id'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS privatestoregroupinfos_active_unique_idx
 ON privatestoregroupinfos
 USING btree
 ((data->>'group_id'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS privatestoregroupinfos_modified_date_index 
  ON privatestoregroupinfos(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS privatestoregroupinfos_created_date_index 
  ON privatestoregroupinfos(created_date DESC NULLS LAST);



  /*  FinancePlans  */


CREATE TABLE IF NOT EXISTS financeplans
(
  id text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT financeplans_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);
ALTER TABLE financeplans
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS financeplans_id_idx
  ON financeplans
  USING btree
 ((data->>'pk_id'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS financeplans_id_unique_idx
  ON financeplans
  USING btree
 ((data->>'pk_id'), (data->>'is_active')) where data->>'is_active'='true';

CREATE INDEX IF NOT EXISTS financeplans_plan_id_status_end_date_is_active_idx
  ON financeplans
  USING btree
 ((data->>'plan_id'), (data->>'status'), (data->>'end_date'), (data->>'is_active'));

 CREATE INDEX IF NOT EXISTS financeplans_plan_id_end_date_is_active_idx
  ON financeplans
  USING btree
 ((data->>'plan_id'), (data->>'end_date'), (data->>'is_active'));

 CREATE INDEX IF NOT EXISTS financeplans_plan_id_is_active_idx
  ON financeplans
  USING btree
 ((data->>'plan_id'), (data->>'is_active'));

 CREATE INDEX IF NOT EXISTS financeplans_plan_name_end_date_is_active_idx
  ON financeplans
  USING btree
 ((data->>'plan_name'),(data->>'end_date'), (data->>'is_active'));

 CREATE INDEX IF NOT EXISTS financeplans_end_date_is_active_idx
  ON financeplans
  USING btree
 ((data->>'end_date'), (data->>'is_active'));


CREATE INDEX IF NOT EXISTS financeplans_modified_date_index 
  ON financeplans(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS financeplans_created_date_index 
  ON financeplans(created_date DESC NULLS LAST);


/*  PROMOAREAOFFERMAPPINGS  */  

CREATE TABLE IF NOT EXISTS promoareaoffermappings
(
  id text,
  promo_area text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT promoareaoffermappings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);

DROP INDEX IF EXISTS promoareaoffermappings_offer_id_idx;

CREATE INDEX IF NOT EXISTS promoareaoffermappings_promoarea_channel_id_idx
 ON promoareaoffermappings
 USING btree
(promo_area, (data->>'is_active'), (data->>'end_date'), (data->>'status'), (data->>'channel'));

CREATE INDEX IF NOT EXISTS promoareaoffermappings_promoarea_id_idx
 ON promoareaoffermappings
 USING btree
(promo_area, (data->>'is_active'), (data->>'end_date'), (data->>'status'));

CREATE UNIQUE INDEX IF NOT EXISTS promoareaoffermappings_active_unique_idx
 ON promoareaoffermappings
 USING btree
 (promo_area, (data->>'offer_id'), (data->>'is_active')) where data->>'is_active'= 'true';


CREATE  INDEX IF NOT EXISTS promoareaoffermappings_offer_id_idx
 ON promoareaoffermappings
 USING btree
 ((data->>'offer_id'));

CREATE INDEX IF NOT EXISTS promoareaoffermappings_modified_date_index 
  ON promoareaoffermappings(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS promoareaoffermappings_created_date_index 
  ON promoareaoffermappings(created_date DESC NULLS LAST);

ALTER TABLE promoareaoffermappings
  OWNER TO ecomdbapriceengine;


/*  PROMOAREAPROMOTIONMAPPINGS  */  

CREATE TABLE IF NOT EXISTS promoareapromotionmappings
(
  id text,
  promo_area text,
  data jsonb,
  created_date timestamp with time zone DEFAULT now(),
  modified_date timestamp with time zone DEFAULT now(),
  CONSTRAINT promoareapromotionmappings_pkey PRIMARY KEY (id)
)
WITH (
  OIDS=FALSE
);

DROP INDEX IF EXISTS promoareapromotionmappings_promotion_id_idx;

CREATE INDEX IF NOT EXISTS promoareapromotionmappings_promoarea_channel_idx
 ON promoareapromotionmappings
 USING btree
(promo_area, (data->>'is_active'), (data->>'end_date'), (data->>'status'), (data->>'channel'));

CREATE INDEX IF NOT EXISTS promoareapromotionmappings_promoarea_channel_type_idx
 ON promoareapromotionmappings
 USING btree
(promo_area, (data->>'is_active'), (data->>'type'), (data->>'status'), (data->>'channel'));

CREATE INDEX IF NOT EXISTS promoareapromotionmappings_promoarea_idx
 ON promoareapromotionmappings
 USING btree
(promo_area, (data->>'is_active'), (data->>'end_date'), (data->>'status'));

 CREATE UNIQUE INDEX IF NOT EXISTS promoareapromotionmappings_active_unique_idx
 ON promoareapromotionmappings
 USING btree
 (promo_area, (data->>'promotion_id'), (data->>'is_active')) where data->>'is_active'= 'true';

CREATE  INDEX IF NOT EXISTS promoareapromotionmappings_promotion_id_idx
 ON promoareapromotionmappings
 USING btree
 ((data->>'promotion_id'));

CREATE INDEX IF NOT EXISTS promoareapromotionmappings_modified_date_index 
  ON promoareapromotionmappings(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS promoareapromotionmappings_created_date_index 
  ON promoareapromotionmappings(created_date DESC NULLS LAST);

ALTER TABLE promoareapromotionmappings
  OWNER TO ecomdbapriceengine;


/*  MESSAGEHISTORY  */  

 CREATE TABLE IF NOT EXISTS MessageHistory
 (
   id uuid,
   data jsonb,
   created_date timestamp with time zone DEFAULT now(),
   modified_date timestamp with time zone DEFAULT now(),
   CONSTRAINT MessageHistory_pkey PRIMARY KEY (id)
 )
 WITH (
   OIDS=FALSE
 );
 ALTER TABLE MessageHistory
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS message_history_status
 ON MessageHistory
 USING btree
((data->>'status'));


/*  JOB  */  

 CREATE TABLE IF NOT EXISTS Jobs
 (
   id uuid,
   data jsonb,
   created_date timestamp with time zone DEFAULT now(),
   modified_date timestamp with time zone DEFAULT now(),
   CONSTRAINT Jobs_pkey PRIMARY KEY (id)
 )
 WITH (
   OIDS=FALSE
 );
 ALTER TABLE Jobs
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS jobs_offerid
 ON Jobs
 USING btree
((data->'payload'->>'offer_id'));

/* B2B orgs */

 CREATE TABLE IF NOT EXISTS B2BOrgs
 (
   id uuid,
   data jsonb,
   created_date timestamp with time zone DEFAULT now(),
   modified_date timestamp with time zone DEFAULT now(),
   CONSTRAINT B2BOrgs_pkey PRIMARY KEY (id)
 )
 WITH (
   OIDS=FALSE
 );
 ALTER TABLE B2BOrgs
  OWNER TO ecomdbapriceengine;

CREATE INDEX IF NOT EXISTS b2bOrgs_orgid_active
 ON B2BOrgs
 USING btree
((data->>'org_id'), (data->>'is_active'));

CREATE UNIQUE INDEX IF NOT EXISTS b2bOrgs_orgid_is_active_idx
 ON B2BOrgs
 USING btree
((data->>'org_id'), (data->'is_active')) where data->>'is_active'= 'true';

CREATE INDEX IF NOT EXISTS b2borgs_modified_date_index 
  ON B2BOrgs(modified_date DESC NULLS LAST);

CREATE INDEX IF NOT EXISTS b2borgs_created_date_index 
  ON B2BOrgs(created_date DESC NULLS LAST);
